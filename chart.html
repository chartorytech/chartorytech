<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chart — Chartory Tech</title>
  <style>
    :root { --bg:#0d1117; --text:#e6edf3; --card:#161b22; }
    html, body { height:100%; }
    body { margin:0; background:var(--bg); color:var(--text); font-family:system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; display:flex; flex-direction:column; }
    header { padding:10px 14px; background:#0b0f14; border-bottom:1px solid #222; display:flex; gap:10px; align-items:center; }
    header a { color:#8ab4ff; text-decoration:none; }
    #panel { display:flex; gap:10px; align-items:center; font-size:14px; }
    input, select { background:#0f141b; color:var(--text); border:1px solid #333; border-radius:8px; padding:8px 10px; }
    #tv { flex:1; }
  </style>
</head>
<body>
  <header>
    <a href="index.html">← 메인으로</a>
    <div id="panel">
      <label>심볼:</label><input id="sym" size="22" />
      <label>주기:</label>
      <select id="intv">
        <option value="1">1m</option>
        <option value="5">5m</option>
        <option value="15">15m</option>
        <option value="60" selected>1h</option>
        <option value="240">4h</option>
        <option value="D">1D</option>
      </select>
      <button onclick="reload()" style="padding:8px 10px;border-radius:8px;border:1px solid #333;background:#238636;color:white;">차트 불러오기</button>
    </div>
  </header>

  <div id="tv" class="tradingview-widget-container"></div>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    const qs = new URLSearchParams(location.search);
    const defSymbol = qs.get('symbol') || 'BINANCE:BTCUSDT';
    const defInterval = qs.get('interval') || '60';
    const symInput = document.getElementById('sym');
    const intvSel = document.getElementById('intv');
    symInput.value = defSymbol;
    intvSel.value = defInterval;

    let widget;
    function load(symbol, interval){
      document.getElementById('tv').innerHTML = ''; // reset container
      widget = new TradingView.widget({
        container_id: 'tv',
        symbol,
        interval,
        autosize: true,
        timezone: "Asia/Seoul",
        theme: "dark",
        style: "1",
        locale: "kr",
        withdateranges: true,
        hide_side_toolbar: false,
        studies: [],
        details: true
      });
    }
    function reload(){
      const s = symInput.value.trim() || defSymbol;
      const i = intvSel.value;
      history.replaceState(null, '', `?symbol=${encodeURIComponent(s)}&interval=${encodeURIComponent(i)}`);
      load(s, i);
    }
    load(defSymbol, defInterval);
  </script>
</body>
</html>
